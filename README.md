LAPPS Exchange Data Structures (LEDS).
======================================

The LAPPS Exchange Data Structures are a small set of Java classes (Groovy classes 
actually) that provide the data model for the JSON-LD data exchanged by services on the
LAPPS grid.

## Maven

To use the package, you need to use following Maven dependency:

```xml
<dependency>
  <groupId>org.anc.lapps</groupId>
  <artifactId>serialization</artifactId>
  <version>0.13.0</version>
</dependency>
```

## Using
There are three main classes that make up LEDS:

1. **Annotation** Used to store information about a single annotation
```groovy
class Annotation {
       String type
       Long start
       Long end
       Map features
       Map metadata
}
```

2. **ProcessingStep** Used to store the list of annotations generated by a single processing service.
```groovy
class ProcessingStep {
      List<Annotation> annotations
      Map metadata
}
```

3. **Container** Used to store the original data (text, audio, etc) plus all annotations produces by all
processing services.
```groovy
class Container {
        String text
        String language
        List<ProcessingStep> steps
        Map metadata
}
```

## Contexts

By default Container objects will define a @context in the JSON document itself.  To refer to the remote @context at http://vocab.lappsgrid.org/context-1.0.0.jsonld create a Container and pass _false_ as the only parameter.

```java
Container containerWithLocalContext = new Container();
Container containerWithRemoteContext = new Container(false);
```

When working with a local @context the entries in the @context are stored in a hash map that can be manipulated at runtime:

```java
Container container = new Container(); // Creates a container with a local @context object.
Map context = container.getContext();
context.put("foo", "http://example.com");

```

## Serializing

_Container_ objects can be serialized to a JSON-LD string with the _toJson()_ or _toPrettyJson()_ methods.  Both representations are identical but the _toPrettyJson()_ method returns a string that is formatted to be human readable,

To create a _Container_ object from a JSON-LD string simply pass the JSON string to the constructor.

```java
String jsonString = ...
Container container = new Container(jsonString);
```

## Metadata

Almost every LEDS object contains a hash map for storing metadata.  In general applications are
free to store whatever metadata they need in these maps.  The only required metadata
is the _contains_ map in the _ProcessingStep_ metadata map.

The _contains_ map contains information about the annotations available in that
processing step as well as the service that generated the annotations.  The _contains_
map looks like

```
"metadata" : {
      "contains" : {
        "Token" : {
          "producer" : "http://service.that.produces.the.tokens",
          "type" : "tokenization:custom"
        }
      }
    },
```

To simplify the process of creating the _contains_ map the _ProcessingStep_ class
provides a _addContains(String label, String producer, String type)_ method. For
 example the above JSON can be generated with:

```java
Container container = new Container(false);
ProcessingStep step = new ProcessingStep()
step.addContains("Token", "http://service.that.produces.the.tokens", "tokenization:custom");
container.addStep(step)
System.out.println(container.toPrettyJson();
```

## Examples

### Java

```java
Annotation a = new Annotation();
a.setType("token");
a.setStart(0);
a.setEnd(5);
a.getFeatures().put("pos", "UH")

ProcessingStep step = new ProcessingStep();
step.getMetadata().put("pass", "1");
step.getAnnotation().add(a);

Container container = new Container();
container.setText("Hello world");
container.setLanguage("en");
container.getSteps().add(step);

String json = container.toJson();
System.out.println(container.toPrettyJson());
...

Container container = new Container(json)
```

### Groovy
```groovy
Annotation a = new Annotation(type:'token', start:0, end:5)
a.features['pos'] = 'UH'

ProcessingStep step = new ProcessingStep()
step.metadata['pass'] = 1
step.annotations.add(a)

Container container = new Container(text:'Hello world')
container.steps.add(step)

String json = container.toJson()

...

Container container = new Container(json)
```
